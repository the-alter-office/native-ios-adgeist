<!DOCTYPE html>
<html>
<head>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no'>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #ad-content {
            display: flex;
            justify-content: center;
            align-items: center;
            max-width: 100%;
            max-height: 100%;
        }
        #ad-content > * {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
    </style>
</head>
<body>
    <div id='ad-content'></div>
    <script src='https://cdn.adgeist.ai/adcard-beta.js'></script>
    <script>
        function initAd() {
            if (typeof AdCard === 'undefined') {
                console.error('AdCard library not loaded');
                return;
            }
            try {
                const creativeData = JSON.parse("{{CREATIVE_DATA}}");
                const adCard = new AdCard(creativeData);
                const html = adCard.renderHtml();
                document.getElementById('ad-content').innerHTML = html;
                document.getElementById('ad-content').addEventListener('click', function(e) {
                    console.log('Ad clicked');
                });
                function checkOverflow() {
                    try {
                        const adgeistCard = document.getElementById('adgeist-card');
                        if (!adgeistCard) {
                            console.error('adgeist-card not found');
                            return;
                        }
                        const viewWidth = window.innerWidth;
                        const viewHeight = window.innerHeight;
                        const cardWidth = adgeistCard.scrollWidth;
                        const cardHeight = adgeistCard.scrollHeight;
                        if (viewWidth && viewHeight && (cardWidth > viewWidth || cardHeight > viewHeight)) {
                            // Check if iOS (webkit) or Android
                            if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.reportOverflow) {
                                window.webkit.messageHandlers.reportOverflow.postMessage({
                                    contentWidth: cardWidth,
                                    contentHeight: cardHeight,
                                    viewWidth: viewWidth,
                                    viewHeight: viewHeight
                                });
                            } else if (typeof Android !== 'undefined' && Android.reportOverflow) {
                                Android.reportOverflow(cardWidth, cardHeight, viewWidth, viewHeight);
                            }
                        } else {
                            // Check if iOS (webkit) or Android
                            if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.showAd) {
                                window.webkit.messageHandlers.showAd.postMessage({});
                            } else if (typeof Android !== 'undefined' && Android.showAd) {
                                Android.showAd();
                            }
                        }
                    } catch (e) {
                        console.error('Error checking overflow: ' + e.message);
                    }
                }
                if(creativeData.adspaceType === 'companion') {
                   checkOverflow();
                }
            } catch (error) {
                console.error('Error rendering ad:', error);
            }
        }
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(initAd, 100);
            });
        } else {
            setTimeout(initAd, 100);
        }
    </script>
</body>
</html>
